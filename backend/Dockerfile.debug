# ---- Build Stage ----
  FROM node:20-slim AS build
  WORKDIR /app

  COPY package*.json ./
  RUN npm ci

  COPY . .
  RUN npm run build
  RUN npx prisma generate
  RUN npm prune --omit=dev

  # ---- Debug Runtime Stage ----
  FROM node:20-slim AS runtime
  RUN apt-get update && apt-get install -y openssl

  WORKDIR /app
  ENV NODE_ENV=development

  COPY --from=build /app .

  EXPOSE 8080
  EXPOSE 9229

  # Keep the container alive for manual inspection
  CMD ["sleep", "3600"]
